# Singelton Design Pattern
생성 패턴 중 하나인 싱글톤 패턴(Singleton pattern)을 따르는 클래스는 생성자가 여러 차례 호출되더라도 실제로 생성되는 객체는 하나이고 최초 생성 이후에 호출된 생성자는 최초의 생성자가 생성한 객체를 리턴한다. 이와 같은 디자인 유형을 싱글톤 패턴이라고 한다. 주로 공통된 객체를 여러개 생성해서 사용하는 DBCP(DataBase Connection Pool)와 같은 상황에서 많이 사용된다.


장점으로는 메모리 효율성과 다른 클래스 간 데이터 공유에 용이하다. 단점으로는 멀티스레딩에 대한 동시성 문제를 해결해야 하며, DIP(의존성 역전)와 OCP(개방폐쇠)의 원칙에 위반될 수 있다. 유연성이 떨어짐.


쉽게 말해 객체의 인스턴스가 오직 1개만 생성하는 패턴을 의미한다. 대표적으로 Bean이 스프링 컨테이너로 싱글톤 스콥을 관리할 때, 싱글톤 패턴으로 관리되고 있습니다. 실제 개발자의 예로는 DB 커넥션이나 스레드 풀 객체를 생성할 때 사용합니다.


싱글톤의 방식으론 3가지 방식이 활용됩니다. 이른 초기화, 게으른 초기화, Holder에 의한 초기화 방식

# 이른 초기화 방식(Eager Initialization)
가장 기본적인 유형으로 전역변수로 인스턴스를 생성하여 싱글톤 오퍼레이션 메소드만 접근 가능하도록 합니다.

장점은 Class Loader에 의해 클래스가 로딩될 때, 오직 한번만 인스턴스가 생성되므로 Thread-Safe하게 싱글톤 객체를 생성할 수 있습니다.
단점은 객체의 사용여부와 클래스 로딩 시점에 인스턴스가 생성되 프로그램이 종료될 때까 메모리를 점유하기 때문에 자주 사용되지 않는 객체라면 비효율적일 수 있다.

# 늦은/게으른 초기화 방식(Lazy Initialization)
클래스의 오퍼레이션 메소드가 호출될 때 인스턴스를 생성합니다. 즉, 클래스 메소드가 호출될 때까지 메모리를 점유하지 않습니다.

장점은 필요할때 객체를 생성할 수 있다는 것입니다.
단점은 멀티 쓰레드(Thread) 환경에서 동시에 호출되어 싱글톤 원칙을 보장할 수 없다는 것입니다.

# 쓰레드 안전 이른 초기화 방식 (Thread safe Lazy Initialization)
늦은 초기화 방식을 보완하여 synchronized 키워드를 메소드에 선언하여 쓰레드 안전(Thread safe) 상태로 싱글톤을 생성할 수 있는 방식입니다. synchronized로 선언된 메소드는 하나의 쓰레드가 메소드를 사용하면 lock을 걸어 다른 쓰레드를 대기상태로 만듭니다.

장점은 Thread-safe 환경이라는 것입니다.
단점은 syncronized가 선언된 메소드가 호출이 많으면 성능이 나빠질 수 있습니다.

# DCL 방식 (Double-Checked locking)
syncronized를 메소드에 선언하는 것이 아니라 메소드 내부에 syncronized 블락을 만드는 방식입니다.

위에 코드와 같이 인스턴스가 없을때 synchronized 키워드를 통해 블락을 만들어 하나의 쓰레드만 작업할 수 있도록 하고 블락 내부에서 다시한번 인스턴스 존재 여부를 체크하게 됩니다. 2번 체크하기때문에 DCL(Double Checking Locking) 방식이라 불립니다.

private 접근자로 설정한 INSTANCE 클래스를 보면 volatile이라는 키워드를 사용했습니다. 하나의 프로세서(CPU)는 최적화를 위해 변수를 메인 메모리에 바로 저장하지 않고 캐쉬메모리에 저장하여 성능을 향상시킵니다. 그러나 volatile로 선언된 변수는 변수를 캐쉬메모리에 저장하지 않고 곧바로 메인메모리에 반영하도록 합니다.

volatile 키워드를 사용하지 않고 멀티코어 환경에서 작업한다면 인스턴스를 캐쉬메모리에 저장하여 메인메모리에 인스턴스를 생성하기전에 다른 코어의 쓰레드가 비어있는 메모리를 참조하기때문에 문제가 발생할 수 있습니다.

# Holder에 의한 초기화 방식
클래스안에 클래스 홀더(Holder)를 두어 JVM 클래스 로더 매커니즘과 클래스가 로드되는 시점을 이용한 방식입니다. 현재까지 가장 많이 이용되고 있는 방식입니다.
안정성이 높음.
